/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-autofix-package-extensions",
factory: function (require) {
var plugin;plugin=(()=>{"use strict";var e={822:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const r=require("@yarnpkg/core"),s=require("path"),o=require("fs");function c(e){return"string"==typeof e.scope?`@${e.scope}/${e.name}`:e.name}const i={hooks:{afterAllInstalled:async(e,n)=>{const{report:t}=n;let i=new Map;const a=new Set,p=new Map,d=new Map,f=new Set;function u(e){return!!l(e)}function l(e){for(const[n,t]of p){if(t.dependencies&&t.dependencies[e])return t.dependencies[e];if(t.devDependencies&&t.devDependencies[e])return t.devDependencies[e]}return null}await t.startTimerPromise("Generating package extensions",async()=>{e.workspaces.forEach(n=>{const t=JSON.parse((0,o.readFileSync)((0,s.join)(n.cwd,"package.json"),"utf-8"));a.add(t.name),p.set(n.cwd,t),d.set(t.name,n.cwd),function(n){const t=e.storedPackages.get(n.anchoredLocator.locatorHash);let r=Array.from(n.dependencies.values()).map(e=>({descriptor:e,parent:t}));r.forEach(n=>{const{descriptor:t,parent:s}=n,o=e.storedPackages.get(e.storedResolutions.get(t.descriptorHash));Array.from(o.dependencies.values()).forEach(e=>{r.push({descriptor:e,parent:o})})});for(let n=r.length-1;n>=0;n--){const{descriptor:t,parent:s}=r[n],o=e.storedPackages.get(e.storedResolutions.get(t.descriptorHash));for(const[e,n]of o.peerDependencies){const t=c(n);if(t.startsWith("@types/"))continue;if(Array.from(s.dependencies.values()).some(e=>c(e)===t))continue;if(Array.from(s.peerDependencies.values()).some(e=>c(e)===t))continue;s.peerDependencies.set(e,n);const r=c(s);i.has(r)||i.set(r,new Set),i.get(r).add(t)}}}(n)}),await r.Configuration.updateConfiguration(e.cwd,e=>{const n=e.packageExtensions||{};for(const[e,t]of i)if(a.has(e)){const n=p.get(d.get(e));if(u(e)){n.peerDependencies=n.peerDependencies||{};for(const r of t){const t=l(r);t?r!==e&&(n.peerDependencies[r]="*",n.devDependencies=n.devDependencies||{},n.devDependencies[r]=t):f.add(r)}}else for(const e of t){const t=l(e);t?(n.dependencies=n.dependencies||{},n.dependencies[e]=t):f.add(e)}}else{const r=e+"@*";n[r]=n[r]||{},n[r].peerDependencies=n[r].peerDependencies||{};for(const s of t)s!==e&&(n[r].peerDependencies[s]="*")}return e.packageExtensions=n,{...e}}),await r.Configuration.updateConfiguration(e.cwd,e=>{const n=e.packageExtensions||{};return Object.keys(n).forEach(e=>{if(n[e]&&n[e].peerDependencies){for(const t of f)delete n[e].peerDependencies[t];0===Object.keys(n[e].peerDependencies).length&&(delete n[e].peerDependencies,0===Object.keys(n[e]).length&&delete n[e])}}),e.packageExtensions=n,{...e}});for(const[e,n]of p)(0,o.writeFileSync)((0,s.join)(e,"package.json"),JSON.stringify(n,null,2)+"\n");if(f.size>0){const n=(0,s.join)(e.cwd,"package.json"),t=JSON.parse((0,o.readFileSync)(n,"utf-8"));t.peerDependenciesMeta=t.peerDependenciesMeta||{};for(const e of f)t.peerDependenciesMeta[e]=t.peerDependenciesMeta[e]||{},t.peerDependenciesMeta[e].optional=!0;(0,o.writeFileSync)(n,JSON.stringify(t,null,2)+"\n")}})}}}}},n={};function t(r){if(n[r])return n[r].exports;var s=n[r]={exports:{}};return e[r](s,s.exports,t),s.exports}return t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(822)})();
return plugin;
}
};